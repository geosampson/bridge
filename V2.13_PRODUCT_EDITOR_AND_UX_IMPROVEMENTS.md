# Version 2.13 - Product Editor Fixes & UX Improvements

## Release Date
December 3, 2025

## Overview
Version 2.13 fixes critical issues with the product editor, adds mouse wheel scrolling to the brand dropdown, and temporarily removes the Capital Stock column until proper implementation.

---

## üéØ What's Fixed

### 1. Product Editor 404 Errors ‚úÖ

**Problem:**
- Editing products (especially variations) resulted in 404 errors
- Error: "Failed to update: 404 Client Error: Not Found for url: .../products/91434"
- Product updates failed silently

**Solution:**
- Added variation detection using `parent_id` field
- Use correct WooCommerce API endpoints:
  - **Variations**: `/products/{parent_id}/variations/{id}`
  - **Regular products**: `/products/{id}`
- Better error messages showing API response details

**Code Changes:**
```python
# Check if this is a variation
parent_id = self.product.get('parent_id')
product_id = self.product['woo_id']

# Update WooCommerce using correct endpoint
if parent_id:
    # It's a variation - use variation endpoint
    endpoint = f"products/{parent_id}/variations/{product_id}"
    response = self.woo_client.wcapi.put(endpoint, data)
else:
    # Regular product
    self.woo_client.update_product(product_id, data)
```

---

### 2. Enhanced Product Editor üìù

**New Features:**
- ‚úÖ **Editable Product Name** - Change product names directly
- ‚úÖ **Scrollable Form** - Better UX for long forms
- ‚úÖ **All Fields Editable**: Name, Regular Price, Sale Price, Short Description, Description

**Before v2.13:**
```
Edit Product Dialog:
- SKU (read-only)
- Product Name (read-only, displayed as label)
- Regular Price (editable)
- Sale Price (editable)
- Short Description (editable)
- Description (editable)
```

**After v2.13:**
```
Edit Product Dialog:
- SKU (read-only header)
- Product Name (EDITABLE input field) ‚≠ê NEW
- Regular Price (editable)
- Sale Price (editable)
- Short Description (editable)
- Description (editable)
- Form is scrollable for better UX ‚≠ê NEW
```

**UI Improvements:**
- Changed `CTkFrame` ‚Üí `CTkScrollableFrame` for form
- Added Product Name entry field at top
- Reorganized row numbers for better layout
- All fields easily accessible

---

### 3. Mouse Wheel Scrolling on Brand Dropdown üñ±Ô∏è

**Problem:**
- Brand dropdown had 50+ brands
- Had to click and scroll with mouse (slow)
- Difficult to navigate quickly

**Solution:**
- Added mouse wheel scrolling support
- Scroll up/down through brands with mouse wheel
- Works on Windows and Linux

**How It Works:**
1. Hover mouse over Brand dropdown
2. Scroll mouse wheel up ‚Üí Previous brand
3. Scroll mouse wheel down ‚Üí Next brand
4. Much faster than clicking!

**Technical Implementation:**
```python
def scroll_brand_dropdown(event):
    current_values = self.product_category_filter.cget("values")
    current_value = self.product_category_filter.get()
    try:
        current_index = current_values.index(current_value)
        if event.delta > 0 or event.num == 4:  # Scroll up
            new_index = max(0, current_index - 1)
        else:  # Scroll down
            new_index = min(len(current_values) - 1, current_index + 1)
        self.product_category_filter.set(current_values[new_index])
    except (ValueError, IndexError):
        pass

# Bind mouse wheel events
self.product_category_filter.bind("<MouseWheel>", scroll_brand_dropdown)
self.product_category_filter.bind("<Button-4>", scroll_brand_dropdown)  # Linux
self.product_category_filter.bind("<Button-5>", scroll_brand_dropdown)  # Linux
```

**Supported Events:**
- `<MouseWheel>` - Windows/Mac mouse wheel
- `<Button-4>` - Linux scroll up
- `<Button-5>` - Linux scroll down

---

### 4. Capital Stock Column Removed (Temporary) üîß

**Problem:**
- Capital Stock column showing `0` for all products
- BALANCEQTY field exists but in different table
- Would require separate API call (slower performance)
- Confusing users with incorrect data

**Solution:**
- Temporarily removed Capital Stock column from Products tab
- Cleaner UI without misleading data
- Will implement proper solution in future version

**What Was Removed:**
- "Capital Stock" column from Products tab
- `capital_stock` field from tree display
- Related column width definitions

**Future Implementation:**
- Query BALANCEQTY from Capital ERP aggregates table
- Make separate API call to fetch stock balances
- Join with product data
- Display accurate stock quantities

---

## üìã Changes Summary

### Files Modified
- `bridge_app.py` - Main application file

### Lines Changed

**ProductEditorDialog (lines 2707-2880):**
- Line 2737: `CTkFrame` ‚Üí `CTkScrollableFrame`
- Lines 2740-2744: Added Product Name entry field
- Lines 2830-2833: Save product name to WooCommerce
- Lines 2845-2858: Variation detection and correct endpoint

**Brand Dropdown (lines 919-947):**
- Lines 929-947: Mouse wheel scroll functionality
- Bound MouseWheel, Button-4, Button-5 events

**Products Tab (lines 1037-1136):**
- Removed "Capital Stock" from columns tuple
- Removed capital_stock heading and column width
- Removed capital_stock from tree insert values

---

## üéØ Impact

### Before v2.13

| Feature | Status |
|---------|--------|
| Edit variations | ‚ùå 404 errors |
| Edit product name | ‚ùå Read-only |
| Brand dropdown scroll | ‚ùå Click only |
| Capital Stock display | ‚ùå Shows zeros |

### After v2.13

| Feature | Status |
|---------|--------|
| Edit variations | ‚úÖ Works perfectly |
| Edit product name | ‚úÖ Fully editable |
| Brand dropdown scroll | ‚úÖ Mouse wheel |
| Capital Stock display | ‚úÖ Removed (clean UI) |

---

## üß™ Testing

### Test Product Editor Fix

1. **Open BRIDGE**
2. **Go to Products tab**
3. **Find a variation product** (e.g., EUROBOOR products with sizes)
4. **Double-click to edit**
5. **Change product name** ‚Üí "TEST NAME"
6. **Change price** ‚Üí 99.99
7. **Click "Save Changes"**
8. **Should see**: "Product updated successfully!" ‚úÖ
9. **No 404 error** ‚úÖ

### Test Mouse Wheel Scroll

1. **Go to Products tab**
2. **Hover mouse over Brand dropdown**
3. **Scroll mouse wheel up** ‚Üí Brand changes to previous
4. **Scroll mouse wheel down** ‚Üí Brand changes to next
5. **Much faster navigation!** ‚úÖ

### Test Capital Stock Removal

1. **Go to Products tab**
2. **Check columns**: SKU, Name, WOO Price, Capital Price, Sale Price, Discount %, WOO Stock, Total Sales, Match
3. **No "Capital Stock" column** ‚úÖ
4. **Cleaner table layout** ‚úÖ

---

## üîÑ How to Update

```bash
cd /path/to/bridge
git pull origin master
```

Then restart BRIDGE - all changes active immediately!

---

## üìù Notes

### Capital Stock Future Implementation

The Capital Stock feature will be re-implemented in a future version with proper data fetching:

**Planned Approach:**
1. Query BALANCEQTY from Capital ERP aggregates table
2. Make separate API call after fetching products
3. Join stock data with product data
4. Display accurate stock quantities

**Why Not Now:**
- BALANCEQTY in different table (not STOCKITEMS)
- Requires additional API call (slower)
- Need to optimize performance first
- Better to have no data than wrong data

### Product Name Editing

The product name field is now editable, but be careful:
- Changing product name affects SEO
- WooCommerce slug may not update automatically
- Consider editing in WooCommerce admin for SEO-critical products

---

## üêõ Known Issues

None reported for v2.13.

---

## üöÄ Next Steps

**Planned for v3.0:**
- Persistent data storage (SQLite database)
- Background refresh (instant startup)
- Proper Capital stock fetching
- Bulk product editing
- Advanced filtering

---

## üìä Version History

| Version | Date | Key Features |
|---------|------|--------------|
| v2.9 | Dec 3, 2025 | Fixed variation price sync |
| v2.10 | Dec 3, 2025 | Selective price refresh |
| v2.11 | Dec 3, 2025 | Smart & manual matching |
| v2.12 | Dec 3, 2025 | Variation-only matching |
| v2.12.1 | Dec 3, 2025 | Capital stock field fix |
| **v2.13** | **Dec 3, 2025** | **Product editor & UX improvements** |

---

## üìû Support

For issues or questions:
- GitHub: https://github.com/geosampson/bridge
- Create an issue with detailed description
- Include error messages and screenshots

---

## ‚úÖ Checklist

After updating to v2.13:

- [ ] Pulled latest code from GitHub
- [ ] Restarted BRIDGE application
- [ ] Tested product editor on variation
- [ ] Tested mouse wheel scroll on brand dropdown
- [ ] Verified Capital Stock column removed
- [ ] All features working as expected

---

**Enjoy the improved BRIDGE experience!** üéâ
