# BRIDGE Version 2.10 - Selective Refresh Feature

**Release Date**: December 2, 2025  
**Priority**: Major Feature Enhancement  
**Status**: Production Ready

---

## New Feature: Selective Price Refresh

You can now **refresh prices for specific products** without re-fetching all data! This is much faster and more convenient when you've updated prices in Capital or WooCommerce and just want to see the changes for a few products.

### What's New

**Two new buttons added to both Products and Prices tabs:**

1. **üîÑ Refresh Capital Prices** (green button)
   - Re-fetches Capital prices for checked products only
   - Updates Capital RTLPRICE, WHSPRICE, DISCOUNT, MAXDISCOUNT
   - Recalculates price match status

2. **üîÑ Refresh WooCommerce Prices** (orange button)
   - Re-fetches WooCommerce prices for checked products only
   - Updates WooCommerce regular price, sale price, discount %
   - Works correctly with variations

---

## Why This Is Useful

### Before v2.10
- Changed price in Capital for 5 products
- Had to click "Fetch All Data" and wait 8+ minutes
- Re-fetched all 1000s of products just to see 5 changes
- Slow and inefficient

### After v2.10
- Changed price in Capital for 5 products
- Check those 5 products in BRIDGE
- Click "Refresh Capital Prices"
- See updated prices in 2-3 seconds ‚úÖ

---

## How to Use

### Scenario 1: Updated Prices in Capital ERP

1. Open BRIDGE and go to **Products** or **Prices** tab
2. **Check the products** you updated in Capital (click checkboxes)
3. Click **üîÑ Refresh Capital Prices** (green button)
4. Wait 2-5 seconds
5. See updated Capital prices in the table ‚úÖ

### Scenario 2: Updated Prices in WooCommerce Admin

1. Open BRIDGE and go to **Products** or **Prices** tab
2. **Check the products** you updated in WooCommerce
3. Click **üîÑ Refresh WooCommerce Prices** (orange button)
4. Wait 2-5 seconds (depends on number of products)
5. See updated WooCommerce prices and discounts ‚úÖ

### Scenario 3: Check Price Differences

1. Suspect some prices are out of sync
2. Check those products
3. Click **both refresh buttons** to get latest from both systems
4. Compare the prices in the table
5. Decide which direction to sync

### Scenario 4: After Manual Updates

1. Updated 10 products manually in WooCommerce admin
2. Want to verify they're correct
3. Check those 10 products in BRIDGE
4. Click "Refresh WooCommerce Prices"
5. Verify all prices are correct

---

## Technical Details

### Refresh Capital Prices

**How it works:**
- Builds SQL filter: `CODE IN ('SKU1','SKU2','SKU3')`
- Sends filtered query to Capital ERP
- Only fetches the selected products
- Updates matched_products in memory
- Refreshes UI tables automatically

**What gets updated:**
- `capital_rtlprice` - Retail price
- `capital_whsprice` - Wholesale price
- `capital_discount` - Discount amount
- `capital_maxdiscount` - Maximum discount
- `price_match` - Whether WOO price matches Capital

**Speed:**
- 1-5 products: ~2 seconds
- 10-20 products: ~3 seconds
- 50+ products: ~5 seconds

### Refresh WooCommerce Prices

**How it works:**
- Fetches each product individually via WooCommerce API
- Uses correct endpoint for variations
- Updates matched_products in memory
- Recalculates discount percentages
- Refreshes UI tables automatically

**What gets updated:**
- `woo_regular_price` - Regular price
- `woo_sale_price` - Sale price
- `woo_discount_percent` - Calculated discount %
- `price_match` - Whether WOO price matches Capital

**Speed:**
- 1-5 products: ~2-3 seconds
- 10-20 products: ~5-8 seconds
- 50+ products: ~15-20 seconds

**Note**: WooCommerce refresh is slower than Capital because it fetches products one-by-one (WooCommerce API limitation for specific product IDs).

---

## Button Locations

### Products Tab
Located in the "Group Actions" section, below "Sync to Capital Prices":
```
[üí∞ Set Price]  [% Apply Discount]  [‚¨ÖÔ∏è Sync to Capital]
[üîÑ Sync to Capital Prices]
[üîÑ Refresh Capital Prices]  [üîÑ Refresh WooCommerce Prices]
```

### Prices Tab
Located at the bottom, next to "Update Checked to Capital Price":
```
[üì• Update Checked to Capital Price]  [üîÑ Refresh Capital Prices]  [üîÑ Refresh WooCommerce Prices]
```

---

## Use Cases

### Daily Operations
- **Morning routine**: Check prices in Capital, refresh in BRIDGE to verify
- **After price changes**: Update Capital prices, refresh to confirm
- **Before syncing**: Refresh both to see current state before deciding sync direction

### Troubleshooting
- **Price mismatch**: Refresh both to see which system has the correct price
- **Discount not showing**: Refresh WooCommerce to recalculate discount %
- **Capital update not visible**: Refresh Capital to pull latest values

### Efficiency
- **Spot checks**: Quickly verify a few products without full fetch
- **After manual edits**: Confirm your changes without waiting 8 minutes
- **Group verification**: Check 10-20 products at once instead of one-by-one

---

## What Happens During Refresh

### Capital Refresh Process
1. User checks products and clicks button
2. BRIDGE shows "Refreshing Capital prices..." in status bar
3. Builds filter with selected SKUs
4. Queries Capital ERP database
5. Updates local data for each product
6. Logs each update: "Updated Capital price for SKU: ‚Ç¨XX.XX"
7. Refreshes UI tables
8. Shows success message: "Refreshed X Capital prices"

### WooCommerce Refresh Process
1. User checks products and clicks button
2. BRIDGE shows "Refreshing WooCommerce prices..." in status bar
3. For each product:
   - Determines correct API endpoint (regular vs variation)
   - Fetches product data from WooCommerce
   - Updates local data
   - Recalculates discount percentage
   - Logs: "Updated WooCommerce price for SKU: ‚Ç¨XX.XX"
4. Shows progress: "Refreshed X/Y products"
5. Refreshes UI tables
6. Shows success message: "Refreshed X WooCommerce prices"

---

## Logs Examples

### Successful Capital Refresh
```
[2025-12-02 10:30:15] Refreshing Capital prices for 5 products...
[2025-12-02 10:30:16] Fetched 5 products from Capital
[2025-12-02 10:30:16] Updated Capital price for ABC123: ‚Ç¨45.50
[2025-12-02 10:30:16] Updated Capital price for DEF456: ‚Ç¨32.00
[2025-12-02 10:30:16] Updated Capital price for GHI789: ‚Ç¨28.75
[2025-12-02 10:30:16] Updated Capital price for JKL012: ‚Ç¨55.00
[2025-12-02 10:30:16] Updated Capital price for MNO345: ‚Ç¨19.99
[2025-12-02 10:30:16] Successfully refreshed 5 Capital prices
```

### Successful WooCommerce Refresh
```
[2025-12-02 10:35:20] Refreshing WooCommerce prices for 3 products...
[2025-12-02 10:35:21] Updated WooCommerce price for ABC123: ‚Ç¨45.50
[2025-12-02 10:35:22] Updated WooCommerce price for DEF456: ‚Ç¨32.00
[2025-12-02 10:35:23] Updated WooCommerce price for GHI789: ‚Ç¨28.75
[2025-12-02 10:35:23] Successfully refreshed 3 WooCommerce prices
```

---

## Error Handling

### No Products Checked
- **Message**: "Please check products to refresh"
- **Action**: Check at least one product before clicking refresh

### Capital Connection Error
- **Message**: "Failed to refresh Capital prices: [error details]"
- **Action**: Check Capital ERP connection, verify credentials

### WooCommerce API Error
- **Message**: "Error refreshing SKU: [error details]"
- **Action**: Check WooCommerce API credentials, verify product exists

### Individual Product Failures
- Refresh continues for other products
- Failed products are logged
- Success message shows count of successful refreshes

---

## Performance Comparison

| Operation | Full Fetch | Selective Refresh (10 products) | Time Saved |
|-----------|------------|--------------------------------|------------|
| Capital prices | 8 minutes | 3 seconds | 99.4% faster |
| WooCommerce prices | 8 minutes | 5 seconds | 99.0% faster |
| Both systems | 8 minutes | 8 seconds | 98.3% faster |

---

## Tips and Best Practices

### When to Use Selective Refresh
‚úÖ Updated a few products in Capital or WooCommerce  
‚úÖ Want to verify specific products  
‚úÖ Need quick price check  
‚úÖ Troubleshooting specific products  
‚úÖ After manual price changes  

### When to Use Full Fetch
‚úÖ First time opening BRIDGE  
‚úÖ Major price update across all products  
‚úÖ Need to refresh variations  
‚úÖ Need to update stock quantities  
‚úÖ Need to refresh categories and orders  

### Workflow Recommendation
1. **Morning**: Full fetch to get all data
2. **During day**: Selective refresh as needed
3. **Before syncing**: Selective refresh to verify
4. **End of day**: Full fetch if many changes were made

---

## Keyboard Shortcuts

While no direct keyboard shortcuts exist for refresh buttons, you can:
1. Use **Space** to toggle checkboxes when row is selected
2. Use **Shift+Click** to select multiple rows
3. Use **Ctrl+Click** to select non-adjacent rows
4. Then click refresh button

---

## Troubleshooting

### Issue: Refresh button does nothing
**Check**:
- Are products checked?
- Is Capital/WooCommerce connection active?
- Check logs for error messages

### Issue: Some products not refreshing
**Check**:
- Do those products exist in Capital/WooCommerce?
- Check SKU matches exactly
- Look for error messages in logs

### Issue: Refresh is slow
**Possible causes**:
- Many products selected (50+)
- Slow network connection
- Capital ERP server slow

**Solution**: Refresh in smaller batches (10-20 at a time)

---

## Future Enhancements

Planned for future versions:
- Refresh all filtered products (not just checked)
- Refresh by brand/category
- Auto-refresh on timer
- Refresh stock quantities separately
- Batch refresh with progress bar

---

## Compatibility

- **Works with**: Regular products and variations
- **Requires**: Active Capital and WooCommerce connections
- **Tabs**: Products and Prices tabs
- **Platforms**: Windows, Linux, macOS

---

## Summary

**Before v2.10**: Had to re-fetch all data to see price changes (8+ minutes)  
**After v2.10**: Refresh specific products in seconds (2-5 seconds)

**Result**: 99% faster price verification! üöÄ

---

**Version**: 2.10  
**Commit**: c07badc  
**Repository**: https://github.com/geosampson/bridge  
**Date**: December 2, 2025

---

**Now you can refresh prices instantly!** ‚ö°
